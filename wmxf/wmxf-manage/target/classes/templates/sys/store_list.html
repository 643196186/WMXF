<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-header">
			
				<h3 class="box-title">
					<span class="fa fa-table"></span> 已有商铺信息
				</h3>
				<div class="box-tools">
					<div class="input-group input-group-sm" style="width: 350px;">
						<input type="text" name="table_search" id="searchNameId"
							class="form-control pull-right" placeholder="用户名">

						<div class="input-group-btn">
							<button type="button" class="btn btn-default btn-search">
								<i class="fa fa-search"></i>
								<span>
									<button type="button" class="btn btn-success">添加</button>
									<button type="button" class="btn btn-warning">修改</button>
									<button type="button" class="btn btn-danger">删除</button>
								</span>
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- /.box-header -->
			<div class="box-body">
				<table id="example1" class="table table-bordered table-striped">
					<thead>
						<tr>
							<th><input type="checkbox" id="checkAll"> 全选</th>
							<th>商铺名称</th>
							<th>联系电话</th>
							<th>营业时间</th>
							<!-- <th>餐厅相册</th>
							<th>logo图片</th> -->
							<th>餐厅地址</th>
							<!-- <th>商家公告</th>
							<th>平均评分</th>
							<th>配送时长</th>
							<th>起送消费</th> -->
							<th>品牌</th>
							<th>城市-站</th>
							<!-- <th>热点地区</th>
							<th>菜系</th>
							<th>地址标识</th> -->
							<!-- <th>销量</th> -->
							<th>配送费</th>
							<th>支付方式</th>
							<!-- <th>所参加的活动</th> -->
						</tr>
					</thead>
					<tbody id="tbodyId">
						<tr>
							<td colspan="9"><span class="pull-right">数据正在加载中...</span></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div id="pageId" 
			     class="box-footer clearfix"
			     th:insert="html/page :: pageDiv">
			</div>
			<!-- /.box-body -->
		</div>
	</div>
</div>
<script type="text/javascript">
   //JS中错误的排查策略:排除法,debugger,console.log()
   $(function(){//页面加载完整之后执行
	   //日志列表页面加载完成以后,异步加载分页页面
	   //$("#pageId").load("doPageUI",function(){
	     //异步加载日志列表数据
	     //doGetObjects();
	   //});
	   //$("#pageId").load("doPageUI",doGetObjects);
	   doGetObjects();
	   //在页面的查询按钮上注册点击事件
	   $(".input-group-btn")
	   .on("click",".btn-search",doQueryObjects)
	   .on("click",".btn-delete",doDeleteObjects)
	   //thead中全选checkbox对象事件注册
	   //change事件一般应用于状态变化
	   $("#checkAll").change(doChangeTBodyCheckBoxState);
	   //tbody中checkbox对象事件注册
	   $("#tbodyId").on("change",".cBox",doChangeTHeadCheckBoxState);
   });
 //分页
 //修改thead中checkbox对象状态
   function doChangeTHeadCheckBoxState(){
	   //获取tbody中所有checkbox对象状态进行"逻辑与"以后的结果
	   var flag=true;//为什么定义变量时指定的默认值为true
	   $("#tbodyId input[type='checkbox']")
	   .each(function(){
		   flag=flag&&$(this).prop("checked");//逻辑与操作
	   })
	   //基于tbody中checkbox对象状态修改thead中checkbox对象状态
	   $("#checkAll").prop("checked",flag);
   }
 
 //全选框
 //修改tbody中checkbox对象的状态
   function doChangeTBodyCheckBoxState(){
	   //1.获取thread中全选checkbox对象的选中状态
	   var flag=$(this).prop("checked");
	   //2.基于全选checkbox对象的状态值,修改tbody中checkbox对象状态
	   $("#tbodyId input[type='checkbox']").prop("checked",flag);
   }
 
 //执行删除按钮事件
   function doDeleteObjects(){
	   //1.获取选中记录id(可能是多个)并校验.
	   var idArray=doGetCheckedIds();
	   console.log("id",idArray);
	   if(idArray.length==0){
		   alert("请先选择");
		   return;
	   }
	   //2.给出删除提示(例如,您确定删除吗)
	   if(!confirm("确定删除吗"))return;
	   //3.发送ajax异步请求执行删除
	   var url="log/doDeleteObjects";
	   var params={"ids":idArray.toString()};//1,2,3
	   $.post(url,params,function(result){
		   if(result.state==1){
			   alert(result.message);
			   //doGetObjects();
			   doRefreshAfterDeleteOK();
		   }else{
			   alert(result.message);
		   }
	   })
   }
 //执行完删除操作以后刷新页面
   function doRefreshAfterDeleteOK(){
  	 var pageCount=$("#pageId").data("pageCount");
  	 var pageCurrent=$("#pageId").data("pageCurrent");
  	 var checked=$("#checkAll").prop("checked");
  	 if(pageCurrent==pageCount&&checked&&pageCurrent>1){
  		 pageCurrent--;
  		 $("#pageId").data("pageCurrent",pageCurrent);
  	 }
     doGetObjects();
   }
   function doQueryObjects(){
	   //1.初始化当前页码值
	   $("#pageId").data("pageCurrent",1);
	   //2.基于查询条件进行查询
	   doGetObjects();
   }
 
 
</script>
